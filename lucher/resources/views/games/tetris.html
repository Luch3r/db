<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Простой Тетрис</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        
        .game-container {
            display: flex;
            gap: 20px;
        }
        
        #game-board {
            width: 300px;
            height: 600px;
            border: 2px solid #333;
            background-color: #111;
            display: grid;
            grid-template-rows: repeat(20, 1fr);
            grid-template-columns: repeat(10, 1fr);
        }
        
        .cell {
            border: 1px solid #222;
        }
        
        .filled {
            border: 1px solid #444;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        #next-piece {
            width: 120px;
            height: 120px;
            border: 2px solid #333;
            background-color: #111;
            display: grid;
            grid-template-rows: repeat(4, 1fr);
            grid-template-columns: repeat(4, 1fr);
        }
        
        .info {
            background-color: #222;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .game-over {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="game-board"></div>
        <div class="sidebar">
            <div class="info">
                <h3>Следующая фигура:</h3>
                <div id="next-piece"></div>
            </div>
            <div class="info">
                <p>Очки: <span id="score">0</span></p>
                <p>Уровень: <span id="level">1</span></p>
                <p>Линии: <span id="lines">0</span></p>
            </div>
            <button id="start-button">Старт/Пауза</button>
            <div id="game-over" class="info game-over" style="display: none;">
                Игра окончена!
            </div>
        </div>
    </div>

    <script>
        // Константы игры
        const COLS = 10;
        const ROWS = 20;
        const EMPTY = 0;
        
        // Цвета фигур
        const COLORS = [
            null,
            '#FF0D72', // I
            '#0DC2FF', // J
            '#0DFF72', // L
            '#F538FF', // O
            '#FF8E0D', // S
            '#FFE138', // T
            '#3877FF'  // Z
        ];
        
        // Фигуры тетрамино
        const SHAPES = [
            null,
            [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0], [0, 0, 0, 0]], // I
            [[2, 0, 0], [2, 2, 2], [0, 0, 0]],                         // J
            [[0, 0, 3], [3, 3, 3], [0, 0, 0]],                         // L
            [[0, 4, 4], [0, 4, 4], [0, 0, 0]],                         // O
            [[0, 5, 5], [5, 5, 0], [0, 0, 0]],                         // S
            [[0, 6, 0], [6, 6, 6], [0, 0, 0]],                         // T
            [[7, 7, 0], [0, 7, 7], [0, 0, 0]]                          // Z
        ];
        
        // Элементы DOM
        const gameBoard = document.getElementById('game-board');
        const nextPieceDisplay = document.getElementById('next-piece');
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const linesElement = document.getElementById('lines');
        const startButton = document.getElementById('start-button');
        const gameOverDisplay = document.getElementById('game-over');
        
        // Игровое состояние
        let board = [];
        let currentPiece = null;
        let nextPiece = null;
        let score = 0;
        let level = 1;
        let lines = 0;
        let gameInterval = null;
        let isPaused = true;
        let isGameOver = false;
        
        // Инициализация игрового поля
        function initBoard() {
            gameBoard.innerHTML = '';
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(EMPTY));
            
            // Создаем клетки игрового поля
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${r}-${c}`;
                    gameBoard.appendChild(cell);
                }
            }
            
            // Инициализируем поле для следующей фигуры
            nextPieceDisplay.innerHTML = '';
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `next-${r}-${c}`;
                    nextPieceDisplay.appendChild(cell);
                }
            }
        }
        
        // Создание случайной фигуры
        function getRandomPiece() {
            const pieceId = Math.floor(Math.random() * 7) + 1;
            return {
                id: pieceId,
                shape: SHAPES[pieceId],
                row: 0,
                col: Math.floor((COLS - SHAPES[pieceId][0].length) / 2),
                color: COLORS[pieceId]
            };
        }
        
        // Отрисовка игрового поля
        function drawBoard() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.getElementById(`cell-${r}-${c}`);
                    if (board[r][c] !== EMPTY) {
                        cell.style.backgroundColor = COLORS[board[r][c]];
                        cell.classList.add('filled');
                    } else {
                        cell.style.backgroundColor = '';
                        cell.classList.remove('filled');
                    }
                }
            }
        }
        
        // Отрисовка текущей фигуры
        function drawPiece() {
            if (!currentPiece) return;
            
            for (let r = 0; r < currentPiece.shape.length; r++) {
                for (let c = 0; c < currentPiece.shape[r].length; c++) {
                    if (currentPiece.shape[r][c] !== EMPTY) {
                        const boardRow = currentPiece.row + r;
                        const boardCol = currentPiece.col + c;
                        
                        if (boardRow >= 0) {
                            const cell = document.getElementById(`cell-${boardRow}-${boardCol}`);
                            if (cell) {
                                cell.style.backgroundColor = currentPiece.color;
                                cell.classList.add('filled');
                            }
                        }
                    }
                }
            }
        }
        
        // Отрисовка следующей фигуры
        function drawNextPiece() {
            // Очищаем поле следующей фигуры
            for (let r = 0; r < 4; r++) {
                for (let c = 0; c < 4; c++) {
                    const cell = document.getElementById(`next-${r}-${c}`);
                    cell.style.backgroundColor = '';
                    cell.classList.remove('filled');
                }
            }
            
            if (!nextPiece) return;
            
            // Центрируем фигуру в поле 4x4
            const offsetRow = Math.floor((4 - nextPiece.shape.length) / 2);
            const offsetCol = Math.floor((4 - nextPiece.shape[0].length) / 2);
            
            for (let r = 0; r < nextPiece.shape.length; r++) {
                for (let c = 0; c < nextPiece.shape[r].length; c++) {
                    if (nextPiece.shape[r][c] !== EMPTY) {
                        const cell = document.getElementById(`next-${r + offsetRow}-${c + offsetCol}`);
                        if (cell) {
                            cell.style.backgroundColor = nextPiece.color;
                            cell.classList.add('filled');
                        }
                    }
                }
            }
        }
        
        // Проверка столкновений
        function hasCollision(pieceRow, pieceCol, pieceShape) {
            for (let r = 0; r < pieceShape.length; r++) {
                for (let c = 0; c < pieceShape[r].length; c++) {
                    if (pieceShape[r][c] !== EMPTY) {
                        const newRow = pieceRow + r;
                        const newCol = pieceCol + c;
                        
                        // Проверяем границы и пересечения с другими фигурами
                        if (
                            newCol < 0 || 
                            newCol >= COLS || 
                            newRow >= ROWS || 
                            (newRow >= 0 && board[newRow][newCol] !== EMPTY)
                        ) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }
        
        // Закрепление фигуры на поле
        function lockPiece() {
            for (let r = 0; r < currentPiece.shape.length; r++) {
                for (let c = 0; c < currentPiece.shape[r].length; c++) {
                    if (currentPiece.shape[r][c] !== EMPTY) {
                        const boardRow = currentPiece.row + r;
                        const boardCol = currentPiece.col + c;
                        
                        if (boardRow < 0) {
                            // Фигура вышла за верхнюю границу - игра окончена
                            gameOver();
                            return;
                        }
                        
                        board[boardRow][boardCol] = currentPiece.id;
                    }
                }
            }
            
            // Проверяем заполненные линии
            checkLines();
            
            // Создаем новую фигуру
            currentPiece = nextPiece;
            nextPiece = getRandomPiece();
            drawNextPiece();
            
            // Если новая фигура сразу сталкивается - игра окончена
            if (hasCollision(currentPiece.row, currentPiece.col, currentPiece.shape)) {
                gameOver();
            }
        }
        
        // Проверка и удаление заполненных линий
        function checkLines() {
            let linesCleared = 0;
            
            for (let r = ROWS - 1; r >= 0; r--) {
                // Проверяем, заполнена ли линия
                if (board[r].every(cell => cell !== EMPTY)) {
                    // Удаляем линию
                    board.splice(r, 1);
                    // Добавляем новую пустую линию вверху
                    board.unshift(Array(COLS).fill(EMPTY));
                    linesCleared++;
                    // Увеличиваем счет, так как мы сдвинули все линии выше
                    r++;
                }
            }
            
            if (linesCleared > 0) {
                // Обновляем счет
                updateScore(linesCleared);
            }
        }
        
        // Обновление счета
        function updateScore(linesCleared) {
            // Система начисления очков как в классическом тетрисе
            const points = [0, 100, 300, 500, 800];
            score += points[linesCleared] * level;
            lines += linesCleared;
            
            // Повышаем уровень каждые 10 линий
            level = Math.floor(lines / 10) + 1;
            
            // Обновляем отображение
            scoreElement.textContent = score;
            levelElement.textContent = level;
            linesElement.textContent = lines;
            
            // Увеличиваем скорость игры с повышением уровня
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = setInterval(moveDown, 1000 / level);
            }
        }
        
        // Движение фигуры вниз
        function moveDown() {
            if (isPaused || isGameOver) return;
            
            if (!hasCollision(currentPiece.row + 1, currentPiece.col, currentPiece.shape)) {
                currentPiece.row++;
            } else {
                lockPiece();
            }
            
            drawBoard();
            drawPiece();
        }
        
        // Движение фигуры влево
        function moveLeft() {
            if (isPaused || isGameOver) return;
            
            if (!hasCollision(currentPiece.row, currentPiece.col - 1, currentPiece.shape)) {
                currentPiece.col--;
                drawBoard();
                drawPiece();
            }
        }
        
        // Движение фигуры вправо
        function moveRight() {
            if (isPaused || isGameOver) return;
            
            if (!hasCollision(currentPiece.row, currentPiece.col + 1, currentPiece.shape)) {
                currentPiece.col++;
                drawBoard();
                drawPiece();
            }
        }
        
        // Поворот фигуры
        function rotate() {
            if (isPaused || isGameOver) return;
            
            // Создаем повернутую матрицу
            const rotated = [];
            for (let c = 0; c < currentPiece.shape[0].length; c++) {
                const newRow = [];
                for (let r = currentPiece.shape.length - 1; r >= 0; r--) {
                    newRow.push(currentPiece.shape[r][c]);
                }
                rotated.push(newRow);
            }
            
            // Проверяем столкновения после поворота
            if (!hasCollision(currentPiece.row, currentPiece.col, rotated)) {
                currentPiece.shape = rotated;
                drawBoard();
                drawPiece();
            }
        }
        
        // Жесткое падение (сбрасывает фигуру сразу вниз)
        function hardDrop() {
            if (isPaused || isGameOver) return;
            
            let newRow = currentPiece.row;
            while (!hasCollision(newRow + 1, currentPiece.col, currentPiece.shape)) {
                newRow++;
            }
            
            currentPiece.row = newRow;
            lockPiece();
            drawBoard();
            drawPiece();
        }
        
        // Обработка нажатий клавиш
        document.addEventListener('keydown', (e) => {
            if (isGameOver) return;
            
            switch (e.key) {
                case 'ArrowLeft':
                    moveLeft();
                    break;
                case 'ArrowRight':
                    moveRight();
                    break;
                case 'ArrowDown':
                    moveDown();
                    break;
                case 'ArrowUp':
                    rotate();
                    break;
                case ' ':
                    hardDrop();
                    break;
                case 'p':
                case 'P':
                    togglePause();
                    break;
            }
        });
        
        // Пауза/продолжение игры
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                clearInterval(gameInterval);
                gameInterval = null;
            } else {
                gameInterval = setInterval(moveDown, 1000 / level);
            }
        }
        
        // Завершение игры
        function gameOver() {
            isGameOver = true;
            clearInterval(gameInterval);
            gameInterval = null;
            gameOverDisplay.style.display = 'block';
        }
        
        // Начало новой игры
        function newGame() {
            // Сброс состояния игры
            score = 0;
            level = 1;
            lines = 0;
            isPaused = true;
            isGameOver = false;
            
            // Обновление отображения
            scoreElement.textContent = score;
            levelElement.textContent = level;
            linesElement.textContent = lines;
            gameOverDisplay.style.display = 'none';
            
            // Очистка интервала
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            // Инициализация игрового поля
            initBoard();
            
            // Создание фигур
            nextPiece = getRandomPiece();
            currentPiece = getRandomPiece();
            drawNextPiece();
            drawBoard();
            drawPiece();
            
            // Обновление текста кнопки
            startButton.textContent = 'Старт';
        }
        
        // Обработка клика по кнопке старта/паузы
        startButton.addEventListener('click', () => {
            if (isGameOver) {
                newGame();
            } else {
                togglePause();
                startButton.textContent = isPaused ? 'Старт' : 'Пауза';
            }
        });
        
        // Инициализация игры при загрузке
        window.onload = newGame;
    </script>
</body>
</html>